{% extends "base.html" %}
{% block content %}
<div class="space-y-10 animate-in fade-in duration-700">
  
  <div class="bg-white rounded-3xl border border-slate-200 p-8 shadow-sm flex flex-col md:flex-row gap-8 items-center">
    <div class="flex-shrink-0 relative h-32 w-32">
      <svg class="h-32 w-32 transform -rotate-90">
        <circle cx="64" cy="64" r="58" stroke="#f1f5f9" stroke-width="12" fill="transparent" />
        <circle cx="64" cy="64" r="58" stroke="#4f46e5" stroke-width="12" fill="transparent" 
          stroke-dasharray="364.4" stroke-dashoffset="{{ 364.4 - (364.4 * total_pct / 100) }}" 
          stroke-linecap="round" />
      </svg>
      <div class="absolute inset-0 flex flex-col items-center justify-center">
        <span class="text-3xl font-black text-slate-800">{{ total_pct }}%</span>
      </div>
    </div>
    <div class="text-center md:text-left">
      <h1 class="text-3xl font-extrabold text-slate-900 tracking-tight">Resultado del Diagnóstico</h1>
      <p class="text-slate-500 mt-2 max-w-lg leading-relaxed">{{ interpretation.message }}</p>
      <div class="mt-4 inline-block bg-indigo-100 text-indigo-700 px-4 py-1 rounded-full text-xs font-bold uppercase tracking-widest">
        Nivel: {{ interpretation.level }}
      </div>
    </div>
  </div>

  <div class="bg-white rounded-3xl border border-slate-200 p-8 shadow-sm">
    <h3 class="text-lg font-bold text-slate-800 mb-8 text-center uppercase tracking-widest text-xs">Análisis de Capacidades Organizacionales</h3>
    <div class="flex justify-center">
      <svg width="560" height="320" viewBox="0 0 560 320" class="max-w-full">
        <g transform="translate(280, 160)">
          <g transform="translate({{ -radar.cx }}, {{ -radar.cy }})">
            {% for ring in radar.rings %}
              <polygon points="{{ ring }}" fill="none" stroke="#e2e8f0" stroke-width="1" />
            {% endfor %}
            {% for line in radar.axis_lines %}
              <line x1="{{ radar.cx }}" y1="{{ radar.cy }}" x2="{{ line.x2 }}" y2="{{ line.y2 }}" stroke="#e2e8f0" stroke-width="1" />
            {% endfor %}
            <polygon points="{{ radar.outer_points }}" fill="rgba(16, 185, 129, 0.08)" stroke="#10b981" stroke-width="2" stroke-dasharray="6 4" />
            <polygon points="{{ radar.polygon_points }}" fill="rgba(79, 70, 229, 0.1)" stroke="#4f46e5" stroke-width="3" />
            {% for label in radar.labels %}
              <text x="{{ label.x }}" y="{{ label.y }}" text-anchor="{{ label.anchor }}" font-size="10" font-weight="700" fill="#64748b" class="uppercase">
                {{ label.text }}
              </text>
            {% endfor %}
          </g>
        </g>
      </svg>
    </div>
    <div class="mt-4 flex flex-wrap items-center justify-center gap-4 text-xs font-semibold text-slate-600">
      <div class="flex items-center gap-2">
        <span class="h-2 w-6 bg-indigo-600 rounded-full"></span>
        <span>Situación actual</span>
      </div>
      <div class="flex items-center gap-2">
        <span class="h-2 w-6 bg-emerald-500 rounded-full"></span>
        <span>Con PlanetaFiscal (referencia ideal)</span>
      </div>
    </div>
  </div>

  {% if ai %}
  <div class="space-y-6">
    <h3 class="text-xl font-bold text-slate-800 flex items-center gap-2">
      <span class="h-2 w-6 bg-indigo-600 rounded-full"></span>
      Recomendación PlanetaFiscal
    </h3>
    <div class="grid gap-6 md:grid-cols-2">
      <div class="bg-indigo-600 rounded-3xl p-8 text-white shadow-xl shadow-indigo-100">
        <h4 class="text-lg font-bold mb-3">{{ ai.titulo }}</h4>
        <p class="text-indigo-100 text-sm leading-relaxed">{{ ai.diagnostico_en_una_frase }}</p>

        <div class="mt-5 rounded-2xl bg-indigo-500/40 p-4 space-y-3">
          <div>
            <p class="text-xs font-bold uppercase tracking-widest text-indigo-100">Lo que te está doliendo</p>
            <p class="mt-2 text-indigo-50 text-sm font-semibold leading-relaxed">{{ ai.lo_que_te_esta_doliendo }}</p>
          </div>
          <div>
            <p class="text-xs font-bold uppercase tracking-widest text-indigo-100">Problema principal</p>
            <p class="mt-2 text-indigo-50 text-sm font-semibold leading-relaxed">{{ ai.problema_principal }}</p>
          </div>
        </div>
      </div>

      <div class="bg-white rounded-3xl border border-slate-200 p-8 shadow-sm">
        <h4 class="text-sm font-bold text-slate-400 uppercase tracking-widest mb-4">Cómo te ayuda PlanetaFiscal</h4>
        <p class="text-sm font-semibold text-slate-700 leading-relaxed">{{ ai.como_ayudamos_planetafiscal }}</p>

        <div class="mt-5">
          <p class="text-xs font-bold uppercase tracking-widest text-slate-400 mb-3">Qué incluye</p>
          <ul class="space-y-2">
            {% for item in ai.que_incluye_planetafiscal %}
              <li class="text-sm font-semibold text-slate-700 flex items-start gap-3">
                <span class="h-5 w-5 rounded bg-indigo-50 text-indigo-600 flex items-center justify-center flex-shrink-0 text-[10px]">•</span>
                {{ item }}
              </li>
            {% endfor %}
          </ul>
        </div>

        <div class="mt-5">
          <p class="text-xs font-bold uppercase tracking-widest text-slate-400 mb-3">Beneficios para ti</p>
          <ul class="space-y-2">
            {% for item in ai.beneficios_para_ti %}
              <li class="text-sm font-semibold text-slate-700 flex items-start gap-3">
                <span class="h-5 w-5 rounded bg-emerald-50 text-emerald-600 flex items-center justify-center flex-shrink-0 text-[10px]">✓</span>
                {{ item }}
              </li>
            {% endfor %}
          </ul>
        </div>

        <div class="mt-6 rounded-2xl bg-slate-50 border border-slate-200 p-4">
          <p class="text-xs font-bold uppercase tracking-widest text-slate-500">Siguiente paso</p>
          <p class="mt-2 text-sm font-semibold text-slate-800 leading-relaxed">
            Hablemos sobre cómo podemos ayudarte a implementar estas soluciones.
          </p>
        </div>
      </div>
    </div>
  </div>
  {% endif %}

  {% if (not ai) and ai_enabled %}
  <div class="bg-amber-50 border border-amber-200 text-amber-900 rounded-2xl p-5">
    <p class="font-semibold">No se pudo generar el plan con IA.</p>
    <p class="text-sm mt-1">{{ ai_error or "Inténtalo de nuevo en unos minutos o revisa tu `OPENAI_API_KEY`." }}</p>
    {% if ai_error_detail %}
      <details class="mt-3 text-xs">
        <summary class="cursor-pointer select-none font-semibold">Detalle (debug)</summary>
        <pre class="mt-2 whitespace-pre-wrap break-words">{{ ai_error_detail }}</pre>
      </details>
    {% endif %}
  </div>
  {% endif %}

  <div class="flex flex-col sm:flex-row gap-4 justify-center py-6">
    <button onclick="window.print()" class="rounded-xl border border-slate-300 bg-white px-8 py-3 text-sm font-bold text-slate-700 hover:bg-slate-50 transition-all">
      Descargar en PDF
    </button>
    <a href="{{ url_for('reset') }}" class="rounded-xl bg-indigo-600 px-8 py-3 text-sm font-bold text-white shadow-lg shadow-indigo-100 hover:bg-indigo-700 transition-all text-center">
      Nuevo Diagnóstico
    </a>
  </div>
</div>
{% endblock %}
